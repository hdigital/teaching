---
title: "HD Quarto template R"
author: "Holger Doering --- holger.doering@gesis.org"
date: today
execute:
  cache: false
  messages: true
  warning: false
format:
  html:
    code-fold: true
    embed-resources: true
    toc: true
---

```{r corepacks}
library(tidyverse)
library(knitr)      # layout // tables in RMarkdown with kable()

library(broom)      # models // tidy results
library(ggeffects)  # models // visualize model effects
library(patchwork)  # plots  // arrange
library(reactable)  # layout // interactive data tables
library(skimr)      # packages // used (once) but not loaded

library(conflicted) # create errors for function name conflicts
conflicts_prefer(dplyr::filter, .quiet = TRUE)
# conflict_scout()

ggplot2::theme_set(theme_minimal())

round_numeric_variables <- function(data, digits = 0) {
  data |> mutate(across(where(is.numeric), \(x) round(x, digits)))
}
```

---

<https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/cars.html>


## Summary data

```{r data}
cars <-
  datasets::mtcars |>
  rownames_to_column(var = "car") |>
  mutate(across(c(cyl, gear), as_factor)) |> 
  as_tibble()
```


```{r check}
#| eval=FALSE

glimpse(cars)
summary(cars)
```


```{r skim}
cars |> skim()
```

```{r skim-numeric}
cars_skim <- 
  cars |>
  skim()  |>
  select(skim_variable, matches("^numeric"))  |>
  rename_with(~ str_remove(.x, "^skim_|^numeric\\.")) |>
  round_numeric_variables(1)
```


## Visualization

```{r figure, message=FALSE}
pl1 <- ggplot(cars, aes(
  x = hp,
  y = mpg,
  color = cyl,
  shape = cyl
)) +
  geom_point(size = 3)

pl2 <- ggplot(cars, aes(x = hp, y = mpg)) +
  geom_point(alpha = 0.5) +
  geom_smooth(se = FALSE)

pl1 + pl2
```


## Linear model

```{r}
m1 <- lm(mpg ~ log(hp) + gear, data = cars)

tidy(m1) |> kable(digits = 2)
glance(m1) |> kable(digits = 2)

ggpredict(m1, terms = c("hp", "gear")) |> plot()
```


## Explore data

```{r explore}
cars |>
  select(car, mpg, hp, cyl, gear) |>
  reactable(searchable = TRUE, striped = TRUE)
```
